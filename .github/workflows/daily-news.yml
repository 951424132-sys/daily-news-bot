---
name: Daily News Push
on:
  workflow_dispatch:
    inputs:
      topic:
        description: News topic
        required: false
        default: äººå·¥æ™ºèƒ½ AI technology
jobs:
  fetch-and-push:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: "3.9"
      - name: Install dependencies
        run: pip install requests feedparser
      - name: Run news bot
        env:
          TOPIC: ${{ github.event.inputs.topic || 'äººå·¥æ™ºèƒ½ AI technology' }}
          WECOM_WEBHOOK_URL: ${{ secrets.WECOM_WEBHOOK_URL }}
        run: >
          python3 - <<'PY'

          import os, urllib.parse, requests, feedparser

          from datetime import datetime


          TOPIC = os.environ.get('TOPIC', 'äººå·¥æ™ºèƒ½ AI technology')

          WEBHOOK = os.environ.get('WECOM_WEBHOOK_URL', '')


          url = (
              f"https://news.google.com/rss/search?q={urllib.parse.quote(TOPIC)}+when:1d"
              f"&hl=zh-CN"
          )

          feed = feedparser.parse(url)


          items = []

          for e in feed.entries[:10]:
              t = e.title.split(' - ')[0] if ' - ' in e.title else e.title
              items.append({'title': t, 'link': e.link})

          date = datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥')

          msg = f"## â˜€ æ—©å®‰ï¼ä»Šæ—¥èµ„è®¯ç®€æŠ¥\n\n**ðŸ“… æ—¥æœŸ**:{date}\n**ðŸ“Œ ä¸»é¢˜**:{TOPIC}\n\n"

          for i, item in enumerate(items, 1):
              msg += f"**{i}.** [{item['title']}]({item['link']})\n"
          msg += "\n---\nðŸ’¡ *ç¥æ‚¨ä»Šå¤©å·¥ä½œé¡ºåˆ©ï¼*"


          if WEBHOOK:
              requests.post(
                  WEBHOOK,
                  json={'msgtype': 'markdown', 'markdown': {'content': msg}},
                  timeout=10
              )
          PY
